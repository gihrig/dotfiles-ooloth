# ------------------------------------------------------------------------------
# SETTINGS
# ------------------------------------------------------------------------------

set -g default-shell /bin/zsh # use zsh instead of sh
set -g default-terminal "tmux-256color" # display things in 256 colors
set -as terminal-overrides ',xterm*:Tc:sitm=\E[3m'

# show more scrollback history
set -g history-limit 20000

# Rather than constraining window size to the maximum size of any client
# connected to the *session*, constrain window size to the maximum size of any
# client connected to *that window*. Much more reasonable.
setw -g aggressive-resize on

# make delay shorter
set -sg escape-time 0

# make window/pane index start with 1
set -g base-index 1
setw -g pane-base-index 1

# Renumber windows when a window is closed.
set -g renumber-windows on

set -g set-titles on
set -g set-titles-string "#T - #W"

# don't rename windows automatically after each executed command
set -g allow-rename off

# enable mouse for scrolling up in the terminal
set -g mouse on

# get notified about activity in other tmux windows
set-option -g display-time 2500 # display messages for 3 seconds
set -wg monitor-activity on
set -wg monitor-bell on

# set statusbar update interval
# set -g status-interval 1

# ------------------------------------------------------------------------------
# KEYBINDINGS
# ------------------------------------------------------------------------------

# Remap prefix from C-b to C-a 
unbind C-b
set -g prefix C-a
bind C-a send-prefix
bind a send-prefix # for nested tmux sessions

# New vertical split with prefix + \ 
unbind %
bind \\ split-window -h 

# New horizontal split with prefix + - 
unbind '"'
bind - split-window -v

# Resize panes with prefix + hjklm
bind -r j resize-pane -D 3
bind -r k resize-pane -U 3
bind -r l resize-pane -R 3
bind -r h resize-pane -L 3
bind -r m resize-pane -Z

# Enter copy mode with Enter
unbind [
bind Enter copy-mode 

# Use Vim keybindings in copy mode.
set-window-option -g mode-keys vi

bind -T copy-mode-vi 'v' send -X begin-selection # start selecting text with "v"
bind -T copy-mode-vi 'y' send -X copy-selection # copy text with "y"
# bind -T copy-mode-vi 'y' send -X copy-pipe-and-cancel "tmux save-buffer - | reattach-to-user-namespace pbcopy"

unbind -T copy-mode-vi MouseDragEnd1Pane # don't exit copy mode when dragging with mouse

unbind p
bind p paste-buffer

# Copy buffers to/from Mac clipboard
bind C-c run 'tmux save-buffer - | reattach-to-user-namespace pbcopy'
bind C-v run 'tmux set-buffer $(reattach-to-user-namespace pbpaste); tmux paste-buffer'

# Lazygit
bind g run 'tmux popup -EE -h 100% -w 100% "lazygit"'

# Open command prompt with , (same as vim)
unbind :
bind , command-prompt
bind r command-prompt -I "#W" "rename-window '%%'" # move default , functionality to r

# Reload config file to apply changes
bind R source-file ~/.config/tmux/tmux.conf \; display " Tmux reloaded"

# ------------------------------------------------------------------------------
# PLUGINS
# ------------------------------------------------------------------------------

set -g @plugin 'tmux-plugins/tpm'               # plugin manager
set -g @plugin 'christoomey/vim-tmux-navigator' # better pane navigation
set -g @plugin 'tmux-plugins/tmux-resurrect'    # restore sessions after system restart
set -g @plugin 'tmux-plugins/tmux-continuum'    # save sessions every 15 minutes
set -g @plugin 'dracula/tmux'

# See: https://github.com/tmux-plugins/tmux-continuum/blob/master/docs/automatic_start.md#os-x
set -g @continuum-boot 'on'                     # start tmux when computer restarts
set -g @continuum-boot-options 'kitty'          # start tmux in kitty instead of Terminal
set -g @continuum-restore 'on'                  # restore last autosaved tmux session
set -g @continuum-save-interval '5'             # save sessions more often

set -g @resurrect-capture-pane-contents 'on'    # restore pane contents
set -g @resurrect-strategy-nvim 'session'
set -g @resurrect-strategy-vim 'session'

# See: https://draculatheme.com/tmux
set -g status-justify centre # center window status
set -g @dracula-plugins 'battery' 
set -g @dracula-battery-colors "dark_gray white" 

# ------------------------------------------------------------------------------
# TPM
# ------------------------------------------------------------------------------

# See: https://github.com/tmux-plugins/tpm/issues/203#issuecomment-858036483
set-environment -g PATH "/opt/homebrew/bin:/usr/local/bin:/bin:/usr/bin"

# Initialize TMUX plugin manager (keep this line at the very bottom of tmux.conf)
run '~/.config/tmux/plugins/tpm/tpm'

# ------------------------------------------------------------------------------
# PLUGIN OVERRIDES 
# ------------------------------------------------------------------------------

# Dracula Color Palette
# See: https://github.com/dracula/tmux/blob/master/scripts/dracula.sh
white='#f8f8f2'
gray='#44475a'
dark_gray='#282a36'
light_purple='#bd93f9'
dark_purple='#6272a4'
cyan='#8be9fd'
green='#50fa7b'
orange='#ffb86c'
red='#ff5555'
pink='#ff79c6'
yellow='#f1fa8c'

# status bar
set -g status-style "bg=${dark_gray},fg=${white}"

# left status
set -g status-left "#[bg=${dark_gray},fg=${white}]#{?client_prefix,#[bg=${yellow}],}#{?client_prefix,#[fg=${dark_gray}],} #S "

# window status
set-window-option -g window-status-current-format "#[fg=${white},bg=${gray}] #I #W "
set-window-option -g window-status-format "#[fg=${white}]#[bg=${dark_gray}] #I #W "

# tmux messages
set-option -g message-style "bg=${yellow},fg=${dark_gray}"

